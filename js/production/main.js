/*! red-bus-test 0.4.5 */
!function(){RB.Templates={},RB.Templates.comment='<div class="rb-comment"><div class="rb-comment-user"><img alt="user" src="img/user.png"></div><div class="rb-comment-content"><h3 class="comment-title"></h3><p class="comment-desc"></p></div><div class="rb-comment-actions"><a href="#" class="comment-edit"></a><a href="#" class="comment-delete"></a></div></div>',RB.Templates.deleteComment='<div class="rb-modal-shell"><div class="rb-modal"><div class="rb-modal-title"></div><div class="rb-modal-content"></div><div class="rb-modal-footer"><a href="#" class="comment-delete-no  btn btn-default"></a><a href="#" class="comment-delete-yes btn btn-primary"></a></div></div></div>',RB.Templates.editComment='<div class="rb-modal-shell"><div class="rb-modal"><div class="rb-modal-title"></div><div class="rb-modal-content"><form class="rb-form"><fieldset><div id="rb-edit-error-holder" class="rb-form-group"></div><div class="rb-form-group"><label for="edit-comment-title"></label><input id="edit-comment-title" class="rb-edit-comment-title" name="title" type="text"></div><div class="rb-form-group"><label for="edit-comment-body"></label><textarea id="edit-comment-body" class="rb-edit-comment-body" name="comment"></textarea></div></fieldset></form></div><div class="rb-modal-footer"><a href="#" class="comment-edit-cancel  btn btn-default"></a><a href="#" class="comment-edit-update btn btn-primary"></a></div></div></div>'}(),function(){var a=function(){var a=this,b={};this.localStorageFlag=!1,this.hasClass=function(a,b){return a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))},this.addClass=function(b,c){a.hasClass(b,c)||(b.className+=" "+c)},this.removeClass=function(b,c){if(a.hasClass(b,c)){var d=new RegExp("(\\s|^)"+c+"(\\s|$)");b.className=b.className.replace(d," ")}};var c=function(){var a="redbus";try{return localStorage.setItem(a,a),localStorage.removeItem(a),!0}catch(b){return!1}};this.trimWhiteSpaces=function(a){return a.replace(/^\s+|\s+$/gm,"")},this.getComments=function(){return b=JSON.parse(localStorage.getItem("theBigAppleComments"))||{}},this.getCommentById=function(a){return b[a]},this.getCommentByTitle=function(a){var c=[];for(var d in b)b[d].title.toLowerCase()===a.toLowerCase()&&c.push(b[d]);return c},this.searchCommentsByTitle=function(){},this.addComment=function(c,d){var e=(new Date).getTime(),f={id:e,title:c,body:d};return b[e]=f,localStorage.setItem("theBigAppleComments",JSON.stringify(b)),a.generateComment(f),this.getComments()},this.updateComment=function(a,c,d){var e={id:a,title:c,body:d},f=document.getElementById(a);return b[a]=e,localStorage.setItem("theBigAppleComments",JSON.stringify(b)),f.querySelector(".comment-title").innerText=c,f.querySelector(".comment-desc").innerText=d,this.getComments()},this.deleteComment=function(a){var c=document.getElementById(a);return delete b[a],localStorage.setItem("theBigAppleComments",JSON.stringify(b)),c.parentNode.removeChild(c),this.getComments()},this.generateComment=function(b){var c=document.getElementById("rb-comments"),d=document.createElement("div");d.className="rb-comment-wrap",d.id=b.id,d.innerHTML=RB.Templates.comment,d.querySelector(".comment-title").innerText=b.title,d.querySelector(".comment-desc").innerText=b.body,d.querySelector(".comment-edit").innerText=RB.GlobalStrings.commentEdit,d.querySelector(".comment-delete").innerText=RB.GlobalStrings.commentDelete,d.querySelector(".comment-edit").addEventListener("click",function(c){c.preventDefault(),a.createEditCommentModal(b.id)}),d.querySelector(".comment-delete").addEventListener("click",function(c){c.preventDefault(),a.createDeleteCommentModal(b.id)}),c.appendChild(d)},this.prepopulateComments=function(){for(var c in b)"object"==typeof b[c]&&a.generateComment(b[c])},this.createDeleteCommentModal=function(b){var c=document.getElementsByTagName("body")[0],d=document.createElement("div");d.className="rb-modal-wrapper",d.innerHTML=RB.Templates.deleteComment,d.querySelector(".rb-modal-title").innerText=RB.GlobalStrings.deleteModalTitle,d.querySelector(".rb-modal-content").innerHTML=RB.GlobalStrings.deleteModalContent,d.querySelector(".comment-delete-no").innerText=RB.GlobalStrings.deleteModalCancel,d.querySelector(".comment-delete-yes").innerText=RB.GlobalStrings.deleteModalConfirm;var e=document.createElement("div");e.className="rb-modal-backdrop";var f=function(){c.removeChild(d),c.removeChild(e),a.removeClass(c,"rb-modal-active")};e.addEventListener("click",function(){f()}),d.querySelector(".comment-delete-no").addEventListener("click",function(a){a.preventDefault(),f()}),d.querySelector(".comment-delete-yes").addEventListener("click",function(c){c.preventDefault(),a.deleteComment(b),f()}),c.appendChild(e),c.appendChild(d),a.addClass(c,"rb-modal-active")},this.createEditCommentModal=function(b){var c=a.getCommentById(b),d=document.getElementsByTagName("body")[0],e=document.createElement("div");e.className="rb-modal-wrapper",e.innerHTML=RB.Templates.editComment,e.querySelector(".rb-modal-title").innerText=RB.GlobalStrings.editModalTitle,e.querySelector(".comment-edit-cancel").innerText=RB.GlobalStrings.editModalCancel,e.querySelector(".comment-edit-update").innerText=RB.GlobalStrings.editModalConfirm,e.querySelector('label[for="edit-comment-title"]').innerText=RB.GlobalStrings.editModalTitleLabel,e.querySelector('label[for="edit-comment-body"]').innerText=RB.GlobalStrings.editModalDescLabel,e.querySelector("#edit-comment-title").value=c.title,e.querySelector("#edit-comment-body").value=c.body;var f=document.createElement("div");f.className="rb-modal-backdrop";var g=e.querySelector("#rb-edit-error-holder"),h=e.querySelector("#edit-comment-title"),i=e.querySelector("#edit-comment-body"),j=function(){d.removeChild(e),d.removeChild(f),a.removeClass(d,"rb-modal-active")};f.addEventListener("click",function(){j()}),e.querySelector(".comment-edit-cancel").addEventListener("click",function(a){a.preventDefault(),j()}),e.querySelector(".comment-edit-update").addEventListener("click",function(b){b.preventDefault();var d=h.value,e=i.value;return""!==a.trimWhiteSpaces(d)&&""!==a.trimWhiteSpaces(e)?d===c.title?(a.showErrorMessage(g),a.updateComment(c.id,d,e),j(),!1):a.getCommentByTitle(d).length?(a.showErrorMessage(g,RB.GlobalStrings.errorHeading,RB.GlobalStrings.errorTitleExists),!1):(a.showErrorMessage(g),a.updateComment(c.id,d,e),j(),!1):void a.showErrorMessage(g,RB.GlobalStrings.errorHeading,RB.GlobalStrings.errorEmptyFields)}),d.appendChild(f),d.appendChild(e),a.addClass(d,"rb-modal-active")},this.createErrorMessage=function(a,b){var c=document.createElement("div");return c.className="rb-form-error",c.innerHTML="<strong>"+a+"</strong>"+b,c},this.showErrorMessage=function(b,c,d){return b.childNodes.length&&b.removeChild(b.childNodes[0]),"undefined"!=typeof c&&"undefined"!=typeof d&&b.appendChild(a.createErrorMessage(c,d)),b};var d=function(){return a.localStorage=c(),a.getComments(),a.prepopulateComments(),a};return d()};RB.Utils=new a}(),function(){RB.Form={},RB.Form.errorHolder=document.getElementById("rb-form-error-holder"),RB.Form.commentTitleInput=document.getElementsByClassName("rb-form-comment-title")[0],RB.Form.commentBodyInput=document.getElementsByClassName("rb-form-comment-body")[0],document.getElementsByTagName("html")[0].className=document.getElementsByTagName("html")[0].className.replace("no-js",""),document.getElementsByClassName("rb-form-comment-submit")[0].addEventListener("click",function(a){a.preventDefault();var b=RB.Form.commentTitleInput.value,c=RB.Form.commentBodyInput.value;""!==RB.Utils.trimWhiteSpaces(b)&&""!==RB.Utils.trimWhiteSpaces(c)?RB.Utils.getCommentByTitle(b).length?(RB.Utils.showErrorMessage(RB.Form.errorHolder,RB.GlobalStrings.errorHeading,RB.GlobalStrings.errorTitleExists),RB.Form.commentTitleInput.value=""):(RB.Utils.showErrorMessage(RB.Form.errorHolder),RB.Utils.addComment(b,c),RB.Form.commentTitleInput.value="",RB.Form.commentBodyInput.value=""):RB.Utils.showErrorMessage(RB.Form.errorHolder,RB.GlobalStrings.errorHeading,RB.GlobalStrings.errorEmptyFields)})}();
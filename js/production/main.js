/*! red-bus-test 0.4.5 */
!function(){RB.Templates={},RB.Templates.comment='<div class="rb-comment"><div class="rb-comment-user"><img alt="user" src="img/user.png"></div><div class="rb-comment-content"><h3 class="comment-title"></h3><p class="comment-desc"></p></div><div class="rb-comment-actions"><a href="#" class="comment-edit"></a><a href="#" class="comment-delete"></a></div></div>',RB.Templates.deleteComment='<div class="rb-modal-shell"><div class="rb-modal"><div class="rb-modal-title"></div><div class="rb-modal-content"></div><div class="rb-modal-footer"><a href="#" class="comment-delete-no  btn btn-default"></a><a href="#" class="comment-delete-yes btn btn-primary"></a></div></div></div>',RB.Templates.editComment='<div class="rb-modal-shell"><div class="rb-modal"><div class="rb-modal-title"></div><div class="rb-modal-content"><form id="rb-form-edit" class="rb-form" action="" method="post"><fieldset><div id="rb-edit-error-holder" class="rb-form-group"></div><div class="rb-form-group"><label for="edit-comment-title"></label><input id="edit-comment-title" class="rb-edit-comment-title rb-form-input" name="title" type="text"></div><div class="rb-form-group"><label for="edit-comment-body"></label><textarea id="edit-comment-body" class="rb-edit-comment-body rb-form-textarea" name="comment"></textarea></div></fieldset></form></div><div class="rb-modal-footer"><a href="#" class="comment-edit-cancel  btn btn-default"></a><a href="#" class="comment-edit-update btn btn-primary"></a></div></div></div>',RB.Templates.searchFormFields='<div id="rb-search-form" class="rb-search-form"><div class="rb-form-group"><input class="rb-search-comment-title rb-form-input" name="title" type="text" placeholder="Please enter the title of the comment to search"></div><div class="rb-form-group"><input class="rb-search-comment-submit" type="submit" name="searchcomment"></div></div>',RB.Templates.searchFormResult='<div id="rb-search-results" class="rb-search-results hidden"><div id="rb-search-info-holder" class="rb-form-group"></div><div class="rb-form-group"><ul class="rb-search-results-list"></ul></div></div>',RB.Templates.searchModal='<div class="rb-modal-shell"><div class="rb-modal"><div class="rb-modal-title"></div><div class="rb-modal-content"><form id="rb-search-comment-form" class="rb-form" action="" method="post"><fieldset></fieldset></form></div><div class="rb-modal-footer"><a href="#" class="comment-search-close  btn btn-default"></a><a href="#" class="comment-search-search-again  btn btn-primary hidden"></a></div></div></div>'}(),function(){var a=function(){var a=this,b={};this.localStorageFlag=!1,this.hasClass=function(a,b){return a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))},this.addClass=function(b,c){a.hasClass(b,c)||(b.className+=" "+c)},this.removeClass=function(b,c){if(a.hasClass(b,c)){var d=new RegExp("(\\s|^)"+c+"(\\s|$)");b.className=b.className.replace(d," ")}};var c=function(){var a="redbus";try{return localStorage.setItem(a,a),localStorage.removeItem(a),!0}catch(b){return!1}};this.trimWhiteSpaces=function(a){return a.replace(/^\s+|\s+$/gm,"")},this.getComments=function(){return b=JSON.parse(localStorage.getItem("theBigAppleComments"))||{}},this.getCommentById=function(a){return b[a]},this.getCommentByTitle=function(a){var c=[];for(var d in b)b[d].title.toLowerCase()===a.toLowerCase()&&c.push(b[d]);return c},this.searchCommentsByTitle=function(a){var c=[];for(var d in b)b[d].title.toLowerCase().match(a.toLowerCase(),"gi")&&c.push(b[d]);return c},this.addComment=function(c,d){var e=(new Date).getTime(),f={id:e,title:c,body:d};return b[e]=f,localStorage.setItem("theBigAppleComments",JSON.stringify(b)),a.generateComment(f),this.getComments()},this.updateComment=function(a,c,d){var e={id:a,title:c,body:d},f=document.getElementById(a);return b[a]=e,localStorage.setItem("theBigAppleComments",JSON.stringify(b)),f.querySelector(".comment-title").innerHTML=c,f.querySelector(".comment-desc").innerHTML=d,this.getComments()},this.deleteComment=function(a){var c=document.getElementById(a);return delete b[a],localStorage.setItem("theBigAppleComments",JSON.stringify(b)),c.parentNode.removeChild(c),this.getComments()},this.generateComment=function(b){var c=document.getElementById("rb-comments"),d=document.createElement("div");d.className="rb-comment-wrap",d.id=b.id,d.innerHTML=RB.Templates.comment,d.querySelector(".comment-title").innerHTML=b.title,d.querySelector(".comment-desc").innerHTML=b.body,d.querySelector(".comment-edit").innerHTML=RB.GlobalStrings.commentEdit,d.querySelector(".comment-delete").innerHTML=RB.GlobalStrings.commentDelete,d.querySelector(".comment-edit").addEventListener("click",function(c){c.preventDefault(),a.createEditCommentModal(b.id)}),d.querySelector(".comment-delete").addEventListener("click",function(c){c.preventDefault(),a.createDeleteCommentModal(b.id)}),c.appendChild(d)},this.prepopulateComments=function(){for(var c in b)"object"==typeof b[c]&&a.generateComment(b[c])},this.createDeleteCommentModal=function(b){var c=document.getElementsByTagName("body")[0],d=document.createElement("div");d.className="rb-modal-wrapper",d.innerHTML=RB.Templates.deleteComment,d.querySelector(".rb-modal-title").innerHTML=RB.GlobalStrings.deleteModalTitle,d.querySelector(".rb-modal-content").innerHTML=RB.GlobalStrings.deleteModalContent,d.querySelector(".comment-delete-no").innerHTML=RB.GlobalStrings.deleteModalCancel,d.querySelector(".comment-delete-yes").innerHTML=RB.GlobalStrings.deleteModalConfirm;var e=document.createElement("div");e.className="rb-modal-backdrop";var f=function(){c.removeChild(d),c.removeChild(e),a.removeClass(c,"rb-modal-active")};e.addEventListener("click",function(){f()}),d.querySelector(".comment-delete-no").addEventListener("click",function(a){a.preventDefault(),f()}),d.querySelector(".comment-delete-yes").addEventListener("click",function(c){c.preventDefault(),a.deleteComment(b),f()}),c.appendChild(e),c.appendChild(d),a.addClass(c,"rb-modal-active")},this.createEditCommentModal=function(b){var c=a.getCommentById(b),d=document.getElementsByTagName("body")[0],e=document.createElement("div");e.className="rb-modal-wrapper",e.innerHTML=RB.Templates.editComment,e.querySelector(".rb-modal-title").innerHTML=RB.GlobalStrings.editModalTitle,e.querySelector(".comment-edit-cancel").innerHTML=RB.GlobalStrings.editModalCancel,e.querySelector(".comment-edit-update").innerHTML=RB.GlobalStrings.editModalConfirm,e.querySelector('label[for="edit-comment-title"]').innerHTML=RB.GlobalStrings.editModalTitleLabel,e.querySelector('label[for="edit-comment-body"]').innerHTML=RB.GlobalStrings.editModalDescLabel,e.querySelector("#edit-comment-title").value=c.title,e.querySelector("#edit-comment-body").value=c.body;var f=document.createElement("div");f.className="rb-modal-backdrop";var g=e.querySelector("#rb-edit-error-holder"),h=e.querySelector("#edit-comment-title"),i=e.querySelector("#edit-comment-body"),j=function(){d.removeChild(e),d.removeChild(f),a.removeClass(d,"rb-modal-active")},k=function(){var b=h.value;b=a.trimWhiteSpaces(b);var d=i.value;return d=a.trimWhiteSpaces(d),""!==b&&""!==d?b===c.title?(a.showErrorMessage(g),a.updateComment(c.id,b,d),j(),!1):a.getCommentByTitle(b).length?(a.showErrorMessage(g,RB.GlobalStrings.errorHeading,RB.GlobalStrings.errorTitleExists),!1):(a.showErrorMessage(g),a.updateComment(c.id,b,d),j(),!1):void a.showErrorMessage(g,RB.GlobalStrings.errorHeading,RB.GlobalStrings.errorEmptyFields)};f.addEventListener("click",function(){j()}),e.querySelector(".comment-edit-cancel").addEventListener("click",function(a){a.preventDefault(),j()}),e.querySelector("#rb-form-edit").addEventListener("submit",function(a){a.preventDefault(),k()}),e.querySelector(".comment-edit-update").addEventListener("click",function(a){a.preventDefault(),k()}),d.appendChild(f),d.appendChild(e),a.addClass(d,"rb-modal-active")},this.createSearchModal=function(){var b=document.getElementsByTagName("body")[0],c=document.createElement("div");c.className="rb-modal-wrapper";var d=document.createElement("div");d.className="rb-modal-backdrop";var e=RB.Templates.searchFormFields,f=RB.Templates.searchFormResult;c.innerHTML=RB.Templates.searchModal,c.querySelector("fieldset").innerHTML=e+f,c.querySelector(".rb-modal-title").innerHTML=RB.GlobalStrings.searchModalTitle,c.querySelector(".rb-search-comment-submit").value=RB.GlobalStrings.searchModalSearch,c.querySelector(".comment-search-search-again").innerHTML=RB.GlobalStrings.searchModalSearchAgain,c.querySelector(".comment-search-close").innerHTML=RB.GlobalStrings.searchModalClose;var g=function(){b.removeChild(c),b.removeChild(d),a.removeClass(b,"rb-modal-active")};c.querySelector(".comment-search-close").addEventListener("click",function(a){a.preventDefault(),g()}),c.querySelector(".comment-search-search-again").addEventListener("click",function(b){b.preventDefault(),g(),a.createSearchModal()}),c.querySelector(".rb-search-comment-submit").addEventListener("click",function(b){b.preventDefault(),a.addClass(document.getElementById("rb-search-form"),"hidden"),a.removeClass(document.querySelector(".rb-search-results"),"hidden"),a.removeClass(document.querySelector(".comment-search-search-again"),"hidden");var e=a.searchCommentsByTitle(c.querySelector(".rb-search-comment-title").value);e.length?a.createResultList(e,c,d):(a.addClass(document.querySelector(".rb-search-results-list"),"hidden"),a.showErrorMessage(document.getElementById("rb-search-info-holder"),RB.GlobalStrings.errorNoResults,""))}),b.appendChild(d),b.appendChild(c),a.addClass(b,"rb-modal-active")},this.createResultList=function(b,c,d){for(var e=a.createInfoMessage(b.length+" "+RB.GlobalStrings.infoFoundComments,RB.GlobalStrings.infoFoundCommentsSubText),f=c.querySelector(".rb-search-results-list"),g=0;g<b.length;g++){var h=document.createElement("li"),i=document.createElement("div");i.className="result-comment",i.setAttribute("data-id",b[g].id),i.addEventListener("click",function(){var b=document.getElementsByTagName("body")[0];b.removeChild(c),b.removeChild(d),a.removeClass(b,"rb-modal-active"),a.createEditCommentModal(this.getAttribute("data-id"))});var j=document.createElement("span");j.className="result-comment-title",j.innerHTML=b[g].title;var k=document.createElement("span");k.className="result-comment-excerpt",k.innerHTML=b[g].body,i.appendChild(j),i.appendChild(k),h.appendChild(i),f.appendChild(h)}var l=document.getElementById("rb-search-info-holder");l.childNodes.length&&l.removeChild(l.childNodes[0]),l.appendChild(e)},this.createErrorMessage=function(a,b){var c=document.createElement("div");return c.className="rb-form-error",c.innerHTML="<strong>"+a+"</strong>"+b,c},this.createInfoMessage=function(a,b){var c=document.createElement("div");return c.className="rb-form-info",c.innerHTML="<strong>"+a+"</strong>"+b,c},this.showErrorMessage=function(b,c,d){return b.childNodes.length&&b.removeChild(b.childNodes[0]),"undefined"!=typeof c&&"undefined"!=typeof d&&b.appendChild(a.createErrorMessage(c,d)),b};var d=function(){return a.localStorage=c(),a.getComments(),a.prepopulateComments(),a};return d()};RB.Utils=new a}(),function(){RB.Form={},RB.Form.errorHolder=document.getElementById("rb-form-error-holder"),RB.Form.commentTitleInput=document.getElementsByClassName("rb-form-comment-title")[0],RB.Form.commentBodyInput=document.getElementsByClassName("rb-form-comment-body")[0],document.getElementsByTagName("html")[0].className=document.getElementsByTagName("html")[0].className.replace("no-js",""),document.getElementsByClassName("rb-form-comment-submit")[0].addEventListener("click",function(a){a.preventDefault();var b=RB.Form.commentTitleInput.value,c=RB.Form.commentBodyInput.value;""!==RB.Utils.trimWhiteSpaces(b)&&""!==RB.Utils.trimWhiteSpaces(c)?RB.Utils.getCommentByTitle(b).length?(RB.Utils.showErrorMessage(RB.Form.errorHolder,RB.GlobalStrings.errorHeading,RB.GlobalStrings.errorTitleExists),RB.Form.commentTitleInput.value=""):(RB.Utils.showErrorMessage(RB.Form.errorHolder),RB.Utils.addComment(b,c),RB.Form.commentTitleInput.value="",RB.Form.commentBodyInput.value=""):RB.Utils.showErrorMessage(RB.Form.errorHolder,RB.GlobalStrings.errorHeading,RB.GlobalStrings.errorEmptyFields)}),document.getElementsByClassName("rb-search")[0].addEventListener("click",function(a){a.preventDefault(),RB.Utils.createSearchModal()})}();